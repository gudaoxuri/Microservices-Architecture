# æœåŠ¡ç†”æ–­å¤„ç†

æœåŠ¡çš„ç†”æ–­åŠé™çº§æ˜¯ç³»ç»Ÿé²æ£’æ€§çš„å…³é”®ä¹‹ä¸€ï¼Œè¿™ä¸æˆ‘ä»¬å¸¸å¬è¯´çš„æœåŠ¡é›ªå´©æœ‰ç€ç´§å¯†çš„å…³ç³»ã€‚

>ğŸ”† é²æ£’æ€§ï¼ˆRobustnessï¼‰æ„ä¸ºå¥å£®ã€å¼ºå£®ï¼Œåœ¨è®¡ç®—ä¸­æŒ‡çš„æ˜¯ç³»ç»Ÿçš„å¥å£®æ€§ï¼Œç”¨äºè¡¨ç¤ºå®¹å¿å¯èƒ½å½±å“ç³»ç»ŸåŠŸèƒ½çš„æ‰°åŠ¨çš„èƒ½åŠ›ã€‚[è¯¦è§æ­¤å¤„](https://en.wikipedia.org/wiki/Robustness)

![](https://raw.githubusercontent.com/gudaoxuri/Microservices-Architecture/master/resources/images/ms-services-circuit1.png?sanitize=true)

ä¸Šå›¾æ˜¯æœåŠ¡é›ªå´©çš„ç¤ºä¾‹ï¼Œå‡è®¾æˆ‘ä»¬çš„ç³»ç»Ÿç”±5ä¸ªæœåŠ¡ç»„æˆï¼ŒæœåŠ¡1è°ƒç”¨æœåŠ¡2ã€3ï¼ŒæœåŠ¡3è°ƒç”¨æœåŠ¡4ã€5ï¼Œä½†ç”±äºæŸäº›åŸå› ï¼ˆåˆ°è¾¾æ€§èƒ½æé™ã€æœªçŸ¥bugã€ç½‘ç»œåˆ†åŒºç­‰ï¼‰æœåŠ¡4è®¿é—®å¾ˆæ…¢ï¼Œè¿™æ—¶å¦‚æœæ²¡æœ‰æœåŠ¡çš„ç†”æ–­ä¸é™çº§é‚£ä¹ˆè°ƒç”¨è€…æœåŠ¡3ä¼šå› ä¸ºæœåŠ¡4å¼‚å¸¸è€Œç§¯ç´¯è¿‡å¤šè¯·æ±‚å¯¼è‡´äº§ç”Ÿå¤§é‡ç­‰å¾…çš„çº¿ç¨‹ï¼ˆBIOæ¨¡å‹ï¼‰ï¼Œè¿›è€ŒæœåŠ¡3ä¹Ÿä¼šå¼•å‘è®¿é—®æ…¢æˆ–ä¸­æ­¢æœåŠ¡çš„é—®é¢˜ï¼Œå¯¹å…¶è°ƒç”¨æœåŠ¡1ä¹Ÿä¼šé‡å¤æœåŠ¡3çš„é—®é¢˜ï¼Œå¦‚æ­¤ä¸€æ¥ï¼Œç”±æœåŠ¡4æœ¬èº«çš„é—®é¢˜è€Œå¼•å‘ä¾èµ–æœåŠ¡çš„æ•´ä¸ªé“¾è·¯éƒ½å‡ºé—®é¢˜ï¼Œè¿™å°±æ˜¯å…¸å‹çš„æœåŠ¡é›ªå´©æ•ˆåº”ã€‚

é›ªå´©æ•ˆåº”ä¹‹æ‰€ä»¥è¿™ä¹ˆè¢«é‡è§†æ˜¯å› ä¸ºå®ƒæå®¹æ˜“åœ¨è¢«äººä»¬å¿½è§†çš„æƒ…å†µä¸‹å‘ç”Ÿï¼Œå¯¹å¾®æœåŠ¡è€Œè¨€ï¼ŒæœåŠ¡å®ä¾‹æˆç™¾ä¸Šåƒï¼Œæˆ‘ä»¬å¾ˆéš¾ä¸€ä¸ªä¸ªæœåŠ¡åœ°æ£€æŸ¥ä»¥ä¿è¯æ¯ä¸ªæœåŠ¡çš„è´¨é‡ï¼Œå¹¶ä¸”å¾ˆå¤šæƒ…å†µä¸‹åªæœ‰åœ¨è¾¾åˆ°ä¸€å®šå‹åŠ›é—®é¢˜æ‰ä¼šæš´éœ²ï¼Œå¸¸è§„çš„ä»£ç Reivewæˆ–æ˜¯é’ˆå¯¹å•ä¸ªæœåŠ¡çš„å‹åŠ›æµ‹è¯•æœªå¿…å¯ä»¥å‘ç°é—®é¢˜ï¼Œå†åˆ™è¿™äº›ä¾èµ–æœåŠ¡æœªå¿…éƒ½æ˜¯æˆ‘ä»¬è‡ªå·±çš„æœåŠ¡ï¼Œå¦‚æœè¯´æˆ‘ä»¬è‡ªå·±æœåŠ¡å°šæœ‰ä¸€å®šçš„æ’æŸ¥ä¼˜åŒ–æ–¹æ³•çš„è¯é‚£ä¹ˆå¯¹ä¸‰æ–¹æœåŠ¡ä¾èµ–è€Œè¨€é‚£å‡ ä¹åªèƒ½æ˜¯å‡­ç»éªŒäº†ï¼Œåªè¦æˆ‘çš„ä¾èµ–æœåŠ¡ä¸­å­˜åœ¨ä¸€å¤„ä¸èµ·çœ¼çš„bugï¼Œæˆ–æ˜¯è¿‡å°‘çš„è¿æ¥æ± é…ç½®ï¼ŒæŠ‘æˆ–æ˜¯ç½‘ç»œæ³¢åŠ¨éƒ½æœ‰å¯èƒ½å¼•å‘é›ªå´©ã€‚

æ€ä¹ˆæœ‰æ•ˆåœ°é¿å…å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥å°è¯•è¿™æ ·è§£å†³ï¼š

è®¾ç½®æ¯ä¸ªè¯·æ±‚çš„è¶…æ—¶æ—¶é—´ä»¥é¿å…æœåŠ¡è¯·æ±‚ä¸€ç›´ç­‰å¾…ä¸‹å»ã€‚è¿˜æ˜¯ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œå¦‚æœæœåŠ¡4åƒµæ­»äº†ï¼Œé‚£ä¹ˆå‘å¾€æœåŠ¡4çš„è¯·æ±‚å¿…å®šä¼šè¶…æ—¶ï¼Œå‡å®šè¶…æ—¶æ—¶é—´1sï¼Œé‚£ä¹ˆåŸæœ¬å¯èƒ½åœ¨100mså†…å®Œæˆçš„è¯·æ±‚éƒ½è¦ç­‰åˆ°1sï¼Œåœ¨è¯·æ±‚é‡å¤§çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡3è¿˜æ˜¯ä¼šå‡ºç°è¯·æ±‚å †ç§¯ï¼Œé€çº§å‘ä¸Šè¿›è€Œå¯¼è‡´é›ªå´©ã€‚

æ‰€ä»¥æˆ‘ä»¬è¿˜è¦åšè¿™æ ·çš„çº¦æŸï¼šè®¾ç½®æ¯ä¸ªè¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼Œè¶…æ—¶Næ¬¡å°±ä¸å†è¯·æ±‚ã€‚å†å¥—ç”¨ä¸Šå›¾çš„ä¾‹å­æˆ‘ä»¬å‘ç°è¿™çš„ç¡®èµ·åˆ°ç«‹ç«¿è§å½±çš„æ•ˆæœï¼Œå¯æœ‰æ•ˆåœ°é˜²æ­¢é›ªå´©ï¼Œè¿™ä¹Ÿæ˜¯æœåŠ¡ç†”æ–­çš„æ ¸å¿ƒå®ç°ä¹‹ä¸€ã€‚

ä½†è¿™ä¹Ÿå­˜åœ¨ä¸€å®šçš„é—®é¢˜ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹æœåŠ¡å¼‚å¸¸æ˜¯ç¬æ—¶çš„ï¼Œæ¯”å¦‚ç½‘ç»œæ³¢åŠ¨ã€ä¸­é—´ä»¶å¼‚å¸¸ï¼ˆå¤šå¯è‡ªæˆ‘æ¢å¤ï¼‰ã€å¹¶å‘é‡é™¡å¢ç­‰ï¼Œæˆ‘ä»¬çš„ç­–ç•¥æ˜¯è¶…æ—¶Næ¬¡ä¸å†è¯·æ±‚ï¼Œè¿™å°±å¯¼è‡´äº†æœåŠ¡æ¢å¤åç³»ç»Ÿä¹Ÿä¼šå¤„äºä¸ç”¨çŠ¶æ€ã€‚

æ›´å¥½çš„åšæ³•æ˜¯å¯ä»¥è‡ªåŠ¨æ¢æµ‹æœåŠ¡æ˜¯å¦æ­£å¸¸ä»¥è¿›è¡Œç†”æ–­å’Œæ¢å¤è¯·æ±‚ã€‚æ¯”å¦‚æˆ‘ä»¬çš„è§„åˆ™å¯ä»¥ä¿®æ”¹æˆï¼šè¯·æ±‚è¶…æ—¶Næ¬¡ååœ¨Xæ—¶é—´ä¸å†è¯·æ±‚å®ç°ç†”æ–­ï¼ŒXæ—¶é—´åæ¢å¤M%çš„è¯·æ±‚ï¼Œå¦‚æœM%çš„è¯·æ±‚éƒ½æˆåŠŸï¼ˆæœªè¶…æ—¶ï¼‰åˆ™æ¢å¤æ­£å¸¸å…³é—­ç†”æ–­ï¼Œå¦åˆ™å†ç†”æ–­Yæ—¶é—´ï¼Œä¾æ­¤å¾ªç¯ã€‚

è¿™æ ·çœ‹ä¸Šå»å¥½å¤šäº†ï¼Œä½†è¿™ç§ç²—æ”¾å¼çš„ç†”æ–­æœåŠ¡ä¼šå¯¼è‡´è¿™äº›è¯·æ±‚è¿”å›é”™è¯¯ï¼Œæ›´ä¼˜é›…çš„æ–¹å¼æ˜¯å®ç°æœåŠ¡é™çº§ï¼Œå³åœ¨ä¾èµ–æœåŠ¡å¼‚å¸¸åå¯ä»¥æœ‰æ›¿ä»£çš„é€»è¾‘ä»¥æä¾›å¤‡ç”¨ï¼Œæ¯”å¦‚æŸä¸€æµç¨‹å¾ˆé‡è¦ï¼Œåœ¨ä¾èµ–çš„æœåŠ¡å¼‚å¸¸åæˆ‘ä»¬å°è¯•è®©è°ƒç”¨æ–¹ä¸´æ—¶æŸ¥è¯¢ä¾èµ–æœåŠ¡çš„ç¼“å­˜æ•°æ®ï¼Œç¼“å­˜æ•°æ®çš„å®æ—¶æ€§å¯èƒ½æ¯”è¾ƒä½ï¼Œä½†ä¸å¤±ä¸ºä¸€ç§ä¸´æ—¶çš„è§£å†³æ–¹æ¡ˆã€‚

å½“ç„¶æˆ‘ä»¬è¿˜å¯ä»¥åšå¾—æ›´å¤šï¼ŒæœåŠ¡å¼‚å¸¸å¾ˆå¤šæƒ…å†µä¸‹æ˜¯å¹¶å‘é‡é™¡å¢å¯¼è‡´ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¼•å…¥é™æµæˆ–æ’é˜Ÿçš„æ–¹æ¡ˆï¼ˆè§åç»­ç« èŠ‚ï¼‰ï¼Œä½¿ç”¨é™æµç›´æ¥æŒ¡æ‰ä¸€æ‰¹è¯·æ±‚ï¼Œæˆ–æ˜¯ä½¿ç”¨æ’é˜Ÿæœºåˆ¶è®©å¤šè¿‡çš„è¯·æ±‚ç­‰å¾…ã€‚

å½“æˆ‘ä»¬æŠŠè¿™æ ·å› ç´ åŠå®ç°éƒ½æ€è€ƒä¹‹åå°±å½¢æˆäº†ä¸€ä¸ªæ¯”è¾ƒç†æƒ³çš„ç†”æ–­å¤„ç†æ–¹æ¡ˆäº†ï¼Œå…¶æ ¸å¿ƒæ˜¯é€šè¿‡ç†”æ–­å®ç°æœåŠ¡ä¿æŠ¤ï¼Œå®ƒä½“ç°åœ¨å¯¹è¯·æ±‚åšé™æµæˆ–æ’é˜Ÿä»¥é˜²æ­¢å¹¶å‘è¶…è¿‡æœåŠ¡é¢„è®¾æŒ‡æ ‡ï¼Œé€šè¿‡ç†”æ–­åŠæ™ºèƒ½çš„æ¢å¤é˜²æ­¢ç³»ç»Ÿé›ªå´©ï¼Œå¼•å…¥å¯é€‰çš„é™çº§æµç¨‹æå‡æœåŠ¡çš„å¯ç”¨æ€§ã€‚

ä¸‹é¢ä¸¾ä¸ªä¾‹å­è¿›ä¸€æ­¥è¯´æ˜ç†”æ–­ä¸é™çº§ï¼Œå¯¹äºæ•°æ®æŸ¥è¯¢åœºæ™¯æˆ‘ä»¬å¯ä»¥ä¼šå¼•å…¥ESä»¥æå‡æŸ¥è¯¢çš„æ€§èƒ½é™ä½æ•°æ®åº“çš„å‹åŠ›ï¼Œè¿™æ˜¯æ­£å¸¸çš„é€»è¾‘ï¼Œä½†å¦‚æœESæŸ¥è¯¢å¼‚å¸¸æ—¶è¦ç¡®ä¿æœåŠ¡å¯ç”¨å°±éœ€è¦èµ°é™çº§ç¾å¤‡æ–¹æ¡ˆï¼Œç¾å¤‡æ–¹æ¡ˆ1æ˜¯ä½¿ç”¨èµ„æºæœ‰é™å®šçš„åªè¯»è´¦å·æŸ¥è¯¢ç”Ÿäº§æ•°æ®åº“ï¼Œå¦‚æœè¾¾åˆ°é™å®šå€¼ä¸ºä¸å½±å“å…¶å®ƒä¸šåŠ¡åªèƒ½è¿›å…¥ç¾å¤‡æ–¹æ¡ˆ2ï¼Œç¾å¤‡æ–¹æ¡ˆ2æŸ¥è¯¢çš„æ˜¯å¤‡ä»½åº“ï¼Œå¤‡ä»½åº“åœ¨æ€§èƒ½ã€æ•°æ®å®æ—¶æ€§ä¸Šéƒ½æœ‰æŸå¤±ï¼Œä½†èµ·ç å¯ä»¥è®©æœåŠ¡å°½å¯èƒ½åœ°å¯ç”¨ï¼ˆå½“ç„¶è¦è§†å…·ä½“åœºæ™¯è€Œè¨€ï¼‰ã€‚

![](https://raw.githubusercontent.com/gudaoxuri/Microservices-Architecture/master/resources/images/ms-services-circuit2.png?sanitize=true)

ç†”æ–­å™¨è¦æ±‚å¯ä»¥æ ¹æ®æœåŠ¡çš„æƒ…å†µè‡ªåŠ¨å‡é™çº§ã€‚ä¸€ä¸ªæ ‡å‡†çš„ç†”æ–­å™¨ä¸€èˆ¬éƒ½åŒ…å«ä¸‰ä¸ªçŠ¶æ€ï¼š

* Closedï¼šç†”æ–­å™¨å…³é—­çŠ¶æ€ï¼Œå³æœåŠ¡æ­£å¸¸
* Openï¼šç†”æ–­å™¨æ‰“å¼€çŠ¶æ€ï¼Œç›´æ¥è¿”å›é”™è¯¯ï¼Œä¸å†å‘èµ·è¯·æ±‚ï¼ˆæ²¡æœ‰ç½‘ç»œå¼€é”€ï¼‰
* Half-Openï¼šåŠç†”æ–­çŠ¶æ€ï¼Œä»‹äºå…³é—­å’Œæ‰“å¼€ä¹‹é—´ï¼Œæ­¤çŠ¶æ€ä¸‹ä¼šå‘é€å°‘é‡è¯·æ±‚ç»™å¯¹åº”çš„æœåŠ¡ï¼Œå¦‚æœè°ƒç”¨æˆåŠŸä¸”è¾¾åˆ°ä¸€å®šæ¯”ä¾‹åˆ™æ¢å¤æœåŠ¡å…³é—­ç†”æ–­å™¨ï¼Œåä¹‹å›åˆ°ç†”æ–­å™¨æ‰“å¼€çŠ¶æ€

Hystrixæ˜¯ç›®å‰æœ€æˆç†Ÿçš„ç†”æ–­å™¨ä¹‹ä¸€ï¼Œå®ƒæ˜¯ä¸€ä¸ªç±»åº“ï¼Œæ–¹ä¾¿ä¸æˆ‘ä»¬çš„ç³»ç»Ÿç»§æ‰¿ï¼Œå®ç°äº†ä¸Šè¿°åŠŸèƒ½å¤–è¿˜æä¾›ç›‘æ§ã€æŠ¥è­¦åŠå¯è§†åŒ–æ“ä½œèƒ½åŠ›ï¼Œç›®å‰æˆç†Ÿçš„JVMå¾®æœåŠ¡æ¡†æ¶éƒ½æœ‰å…¶é›†æˆæ–¹æ¡ˆã€‚

>âš  Hystrixå·²å¤„äºç»´æŠ¤æœŸï¼Œä¸å†æ·»åŠ æ–°åŠŸèƒ½ï¼Œæ¨èä½¿ç”¨æ›´è½»é‡çš„[resilience4j](https://github.com/resilience4j/resilience4j)ã€‚













